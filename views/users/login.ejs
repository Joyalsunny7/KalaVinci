<link rel="stylesheet" href="/css/user/login.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

<!-- BACKGROUND -->
<div class="login-wallpaper"></div>

<main class="login-wrapper">

  <!-- GLASS LOGIN CARD -->
  <section class="login-section">

    <a href="/auth/google" class="google-btn">
      <img src="https://www.gstatic.com/images/branding/product/1x/gsa_512dp.png" width="18">
      Continue with Google
    </a>

    <div class="divider">OR</div>

    <form action="/login" method="POST" id="loginForm">

      <div class="form-group">
        <label>Email</label>
        <input type="email" name="email" placeholder="Email"/>
      </div>

      <div class="form-group password-group">
        <label>Password</label>
        <input
          type="password"
          id="password"
          name="password"
          placeholder="Enter your password"
          class="password-input"
        />
        <span class="toggle-password" id="togglePassword">
          <i class="fa-solid fa-eye"></i>
        </span>
      </div>

      <% if (typeof message !== 'undefined' && message) { %>
        <div class="error" id="loginError"><%= message %></div>
      <% } %>

      <a href="/forgot-password" class="forgot-link">Forgot Password?</a>

      <button type="submit" class="login-btn">Login</button>
    </form>

    <p class="signup-text">
      Donâ€™t have an account? <a href="/signup">Sign up</a>
    </p>

  </section>
</main>

<script>

// Password toggle
const passwordInput = document.getElementById("password");
const togglePassword = document.getElementById("togglePassword");
const icon = togglePassword?.querySelector("i");

togglePassword?.addEventListener("click", () => {
  const hidden = passwordInput.type === "password";
  passwordInput.type = hidden ? "text" : "password";
  icon.classList.toggle("fa-eye");
  icon.classList.toggle("fa-eye-slash");
});

// Prevent error persistence on refresh
(() => {
  const errorBox = document.getElementById("loginError");
  const form = document.getElementById("loginForm");

  if (errorBox && !sessionStorage.getItem("loginSubmitted")) {
    errorBox.style.display = "none";
  }

  form?.addEventListener("submit", () => {
    sessionStorage.setItem("loginSubmitted", "true");
  });

  window.addEventListener("pageshow", () => {
    sessionStorage.removeItem("loginSubmitted");
  });
})();


</script>
