<%- include('../partials/header', { title: 'Edit Profile | Kala Vinci' }) %>
  <%- include('../partials/accountHeader') %>

    <link rel="stylesheet" href="/css/user/editprofile.css" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

    <main class="container main-layout">
      <%- include('../partials/accountSidebar') %>

        <section class="profile-content">
          <div class="profile-card">

            <!-- ONE FORM ONLY -->
            <form action="/update" method="POST" enctype="multipart/form-data" id="editProfileForm">

              <!-- ================= AVATAR ================= -->
              <div class="profile-pic-container">
                <div class="avatar-placeholder">
                  <img id="profilePreview" src="<%= user.profileImage || '/images/default-avatar.png' %>"
                    class="profile-avatar" alt="Profile Image" />
                </div>

                <input type="file" name="profileImage" id="profileImageInput" accept="image/*" hidden />

                <button type="button" id="add-photo-btn">
                  Add Photo
                </button>
              </div>

              <!-- ================= PROFILE FIELDS ================= -->
              <div class="profile-form">

                <div class="form-group">
                  <label for="name">Name</label>
                  <input type="text" id="name" name="name" value="<%= user.full_name %>" required />
                </div>

                <div class="form-group">
                  <label for="email">Email</label>
                  <input type="email" id="email" name="email" value="<%= user.email %>" readonly />

                  <button type="button" class="reset-email-btn" onclick="window.location.href='/reset-email'">
                    Reset Email
                  </button>
                </div>

                <div class="form-group">
                  <label for="mobile">Mobile</label>
                  <input type="text" id="mobile" name="mobile" value="<%= user.phone %>" required />
                </div>

                <div class="form-actions">
                  <button type="submit" class="save-btn">
                    <i class="fa-solid fa-floppy-disk"></i>
                    Save Changes
                  </button>
                </div>

              </div>
            </form>

          </div>
        </section>
    </main>

    <%- include('../partials/footer') %>

      <script>
        const fileInput = document.getElementById('profileImageInput');
        const preview = document.getElementById('profilePreview');
        const addPhotoBtn = document.getElementById('add-photo-btn');
        const form = document.getElementById('editProfileForm');


        addPhotoBtn.addEventListener('click', () => {
          fileInput.click();
        });

        form.addEventListener('submit', () => {
          console.log('âœ… FORM SUBMITTED');
          console.log('Name:', document.getElementById('name').value);
          console.log('Mobile:', document.getElementById('mobile').value);
        });

        fileInput.addEventListener('change', () => {
          const file = fileInput.files[0];
          if (!file) return;

          const reader = new FileReader();
          reader.onload = () => {
            preview.src = reader.result;
          };
          reader.readAsDataURL(file);
        });
      </script>